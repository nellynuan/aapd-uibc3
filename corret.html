<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ä½œæ¥­æ‰¹æ”¹å›é¥‹å€</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/regular/style.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css"
    />
    <style>
      body {
        background-color: #f7f6f5;
      }

      .container {
        max-width: 1300px;
        padding: 0 24px;
      }

      .text-box {
        padding: 16px 20px 12px 12px;
        border: 2px solid #dbdbdb;
        border-radius: 10px;
        background-color: #f8f8f7;
      }

      .btn-copy {
        color: #6e7781;
      }
      .btn-clear {
        color: #df6b42;
      }

      .auto-resize-textarea {
        width: 100%;
        overflow: hidden;
        resize: none;
        background-color: transparent;
        border: none;
        outline: none;
      }

      .section-title {
        color: #6e7781;
        font-size: 24px;
        font-weight: 500;
      }

      .section-text {
        color: #6e7781;
      }

      .table-box {
        background-color: #fff;
        border-radius: 8px;
        padding: 24px;
      }

      .title {
        padding: 0 0 12px;
      }

      .title-success {
        color: #57ad57;
        border: 0 solid #57ad57;
        border-bottom-width: 1px;
      }
      .title-danger {
        color: #da0000;
        border: 0 solid #da0000;
        border-bottom-width: 1px;
      }

      .title-warning {
        color: #f89100;
        border: 0 solid #f89100;
        border-bottom-width: 1px;
      }

      .table-box h2 {
        font-size: 24px;
        font-weight: 500;
      }

      .table-box h2 small {
        font-size: 16px;
        font-weight: 400;
      }

      th {
        color: #a9b2ba !important;
        font-size: 14px;
      }

      td i {
        font-size: 24px;
      }

      .content-box {
        margin-bottom: 40px;
      }

      .content {
        background-color: white;
        padding: 20px 24px;
        border-radius: 16px 16px 0 16px;
      }

      .content-box small {
        color: #a9b2ba;
        font-size: 14px;
        padding: 8px;
      }

      h3 {
        font-size: 16px;
      }
    </style>
  </head>
  <body class="container py-5">
    <div class="row">
      <div class="col-md-6">
        <div class="text-box d-flex flex-column justify-content-between h-100">
          <div class="d-flex gap-2">
            <div class="edit-icon">
              <img
                src="https://www.notion.so/icons/drafts_gray.svg?mode=light"
                style="width: 24px"
              />
            </div>
            <div id="previewArea"></div>
          </div>

          <div class="d-flex justify-content-end">
            <button class="btn btn-copy" onclick="copyFeedback()">
              <i class="ph ph-copy me-1"></i>è¤‡è£½
            </button>
            <button class="btn btn-clear" onclick="clearFeedback()">
              <i class="ph ph-broom me-1"></i>æ¸…é™¤
            </button>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="d-flex flex-column justify-content-between h-100">
          <div class="p-3">
            <h1 class="section-title">åŠ©æ•™ Duki çš„ä½œæ¥­æ‰¹æ”¹å€</h1>
            <ol class="section-text mt-3">
              <li>æ­¤æ‰¹æ”¹è¡¨è¨˜éŒ„åˆ°å­¸å“¡å¡ç‰‡æ™‚ã€Œæ‰¹æ”¹ç‹€æ…‹ã€æ›´æ–°ç‚ºã€Œå·²å®Œæˆã€</li>
              <li>å…¶ä»–çš„æ³¨æ„äº‹é …è«‹å¡«å¯«å‚™è¨»...</li>
            </ol>
          </div>
          <div class="d-flex gap-3">
            <div class="content-box w-100">
              <div class="content">
                é€™ä»½ä½œæ¥­åœ¨ã€ŒåŸºç¤éŒ¯èª¤ã€é …ç›®æœ‰è¢«æ‰£åˆ†ï¼Œå› æ­¤ä½œæ¥­è©•ç´šç‚ºã€Œæœ‰å¾…åŠ å¼·ã€
              </div>
              <small>æ‰¹æ”¹çµæœåƒ…ä½œç‚ºåƒè€ƒï¼ŒåŠ©æ•™ä»å¯æ–Ÿé…Œèª¿æ•´è©•ç´š</small>
            </div>
            <div class="d-flex align-items-end">
              <img
                src="https://i.ibb.co/qFYQP9Wg/Student-Avatar.png"
                style="width: 100px"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row mt-4">
      <div class="col-12">
        <div class="table-box">
          <div>
            <h2
              class="d-flex justify-content-between align-items-end title title-success"
            >
              <span><i class="ph-fill ph-star-four pe-1"></i>é¼“å‹µå€</span>
              <small>æ‰¹æ”¹ä½œæ¥­ä¹‹å¤–ä¹Ÿè¦è¨˜å¾—é¼“å‹µåŒå­¸åšå¾—å¥½çš„åœ°æ–¹å–”ï¼</small>
            </h2>

            <table class="table table-borderless align-middle mt-3 table-hover">
              <thead>
                <tr>
                  <th scope="col" style="width: 5%"></th>
                  <th scope="col" style="width: 5%">åˆ†æ•¸</th>
                  <th scope="col" style="width: 15%">æ‰¹æ”¹é …ç›®</th>
                  <th scope="col" style="width: 80%">å›é¥‹å…§å®¹</th>
                </tr>
              </thead>
              <tbody id="tbody-1"></tbody>
            </table>
          </div>
          <div class="pt-5">
            <h2
              class="d-flex justify-content-between align-items-end title title-danger"
            >
              <span><i class="ph-fill ph-star-four pe-1"></i>åŸºç¤éŒ¯èª¤å€</span>
              <small
                >æ­¤å€é …ç›®ç‚ºæœ¬é€±ä½œæ¥­çš„æ ¸å¿ƒé‡é»ï¼Œè‹¥çŠ¯äº†åŸºç¤éŒ¯èª¤ï¼Œå‰‡è¡¨ç¤ºå­¸å“¡çš„åŸºç¤ä¸ç©©</small
              >
            </h2>

            <table class="table table-borderless align-middle mt-3 table-hover">
              <thead>
                <tr>
                  <th scope="col" style="width: 5%"></th>
                  <th scope="col" style="width: 5%">åˆ†æ•¸</th>
                  <th scope="col" style="width: 15%">æ‰¹æ”¹é …ç›®</th>
                  <th scope="col" style="width: 80%">å›é¥‹å…§å®¹</th>
                </tr>
              </thead>
              <tbody id="tbody-2"></tbody>
            </table>
          </div>
          <div class="pt-5">
            <h2
              class="d-flex justify-content-between align-items-end title title-warning"
            >
              <span><i class="ph-fill ph-star-four pe-1"></i>é€²éšéŒ¯èª¤å€</span>
              <small
                >æ­¤å€é …ç›®ç‚º Nice to Haveï¼Œè‹¥å”åŠ©æŒ‡å‡ºéŒ¯èª¤ï¼Œå¯è®“å­¸å“¡çš„ UI
                èƒ½åŠ›æ›´åŠ é€²æ­¥</small
              >
            </h2>

            <table class="table table-borderless align-middle mt-3 table-hover">
              <thead>
                <tr>
                  <th scope="col" style="width: 5%"></th>
                  <th scope="col" style="width: 5%">åˆ†æ•¸</th>
                  <th scope="col" style="width: 15%">æ‰¹æ”¹é …ç›®</th>
                  <th scope="col" style="width: 80%">å›é¥‹å…§å®¹</th>
                </tr>
              </thead>
              <tbody id="tbody-3"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <script>
      let totalScore = 0;
      let openingText = "";
      let closingText = "";
      let md = "";
      let feedbackList = [];

      try {
        google.script.run
          .withSuccessHandler((data) => {
            openingText = data.opening;
            closingText = data.closing;
            createButtons(data.praiseData, "tbody-1", "praise");
            createButtons(data.baseDeductData, "tbody-2", "base");
            createButtons(data.advDeductData, "tbody-3", "adv");
            updateFeedbackArea();
          })
          .getFeedbackData();
      } catch (ex) {
        openingText = "å—¨æˆ‘æ˜¯ Nellyï¼Œæ­å–œå®Œæˆç¬¬ä¸€é€±ä½œæ¥­";
        closingText = "æœŸå¾…å†æ”¶åˆ°ä½ è®šè®šçš„ä½œæ¥­ ğŸ’ªğŸ»";
        const praiseData = [
          ["é¼“å‹µ1", "é‚„è¡Œ", "1"],
          ["é¼“å‹µ2", "é‚„OK", "1"],
        ];
        const baseDeductData = [
          ["åŸºæ‰£1", "åŠ æ²¹", "-1"],
          ["åŸºæ‰£2", "å¥½å—", "-1"],
        ];
        const advDeductData = [
          ["é€²æ‰£1", "çˆ›é¼ ", "-1"],
          ["é€²æ‰£2", "æ°£é¼ ", "-1"],
        ];
        createButtons(praiseData, "tbody-1", "praise");
        createButtons(baseDeductData, "tbody-2", "base");
        createButtons(advDeductData, "tbody-3", "adv");
        updateFeedbackArea();
      }

      function createButtons(items, containerId, type) {
        console.log(items);
        items.forEach(([title, content, score]) => {
          const tr = document.createElement("tr");
          const isSelected = feedbackList.some(
            (i) => i.title === title && i.type === type
          );
          const iconClass = isSelected ? "ph-check-square" : "ph-square";
          tr.innerHTML = `
          <td style="text-align: center;"><i class="ph ${iconClass}"></i></td>
          <td>${score > 0 ? "+" + score : score}</td>
          <td>${title}</td>
          <td>${content}</td>
        `;
          tr.onclick = () => {
            const icon = tr.querySelector("td i");

            if (icon.classList.contains("ph-check-square")) {
              icon.classList.remove("ph-check-square");
              icon.classList.add("ph-square");
              deleteItem(title, content, score, type);
            } else {
              icon.classList.remove("ph-square");
              icon.classList.add("ph-check-square");
              addItem(title, content, score, type);
            }
          };
          const tbody = document.getElementById(containerId);
          tbody.appendChild(tr);
        });
      }

      function addItem(title, content, score, type) {
        const item = {
          content: `- ${content}`,
          title,
          score: parseInt(score),
          type,
        };
        feedbackList.push(item);
        updateFeedbackArea();
      }

      function deleteItem(title, content, score, type) {
        feedbackList = feedbackList.filter(
          (i) => !(i.title === title && i.type === type)
        );
        updateFeedbackArea();
      }

      function updateFeedbackArea() {
        console.log(feedbackList);
        const good =
          feedbackList
            .filter((f) => f.type === "praise")
            .map((f) => f.content)
            .join("\n\n") || "- ";
        const better =
          feedbackList
            .filter((f) => f.type !== "praise")
            .map((f) => f.content)
            .join("\n\n") || "- ";
        md = `${openingText}\n\n### åšå¾—å¥½çš„åœ°æ–¹\n${good}\n\n### å¯ä»¥å†æ›´å¥½çš„åœ°æ–¹\n${better}\n\n${closingText}`;
        document.getElementById("previewArea").innerHTML = marked.parse(md);
      }

      function copyFeedback() {
        navigator.clipboard
          .writeText(md)
          .then(() => {
            Swal.fire({
              icon: "success",
              title: "å·²è¤‡è£½",
              showConfirmButton: false,
              timer: 1500,
            });
          })
          .catch((err) => {
            Swal.fire({
              title: "è¤‡è£½å¤±æ•—",
              showConfirmButton: false,
              timer: 1500,
            });
          });
      }

      function clearFeedback() {
        feedbackList = [];
        updateFeedbackArea();

        const icons = document.querySelectorAll("tr i");

        icons.forEach((icon) => {
          if (icon.classList.contains("ph-check-square")) {
            icon.classList.remove("ph-check-square");
            icon.classList.add("ph-square");
          }
        });
      }
    </script>
  </body>
</html>
