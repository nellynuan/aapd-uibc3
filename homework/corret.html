<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>作業批改回饋區</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/regular/style.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css"
    />
    <style>
      body {
        background-color: #f7f6f5;
        height: 100vh;
        overflow: hidden;
      }

      tr {
        cursor: pointer;
      }

      .container {
        max-width: 1320px;
        padding: 48px 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        margin: 0 auto;
      }

      .text-box {
        padding: 16px 20px 12px 12px;
        border: 2px solid #dbdbdb;
        border-radius: 10px;
        background-color: #f8f8f7;
        height: 100%;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        position: relative;
      }

      .btn-copy {
        color: #6e7781;
      }
      .btn-clear {
        color: #df6b42;
      }

      .auto-resize-textarea {
        width: 100%;
        overflow: hidden;
        resize: none;
        background-color: transparent;
        border: none;
        outline: none;
      }

      .section-title {
        color: #6e7781;
        font-size: 24px;
        font-weight: 500;
      }

      .section-text {
        color: #32302C;
      }

      .section-text a {
        color: #32302C;
        text-decoration: underline;
      }

      .section-text a:hover {
        color: #1a1816;
      }

      .table-box {
        background-color: #fff;
        border-radius: 8px;
        padding: 20px;
        height: 100%;
        overflow-y: auto;
        box-shadow: 0px 4px 32px 0px rgba(0, 0, 0, 0.05);
        padding-top: 20px;
        padding-bottom: 20px;
      }

      .table-box::-webkit-scrollbar {
        width: 6px;
      }

      .table-box::-webkit-scrollbar-track {
        background: transparent;
      }

      .table-box::-webkit-scrollbar-thumb {
        background: #D1D5DB;
        border-radius: 3px;
      }

      .title {
        padding: 0 0 8px;
      }

      .title-success {
        color: #57ad57;
        border: 0 solid #57ad57;
        border-bottom-width: 1px;
      }
      .title-danger {
        color: #da0000;
        border: 0 solid #da0000;
        border-bottom-width: 1px;
      }

      .title-warning {
        color: #f89100;
        border: 0 solid #f89100;
        border-bottom-width: 1px;
      }

      .table-box h2 {
        font-size: 20px;
        font-weight: 500;
        display: flex;
        align-items: center;
      }

      .table-box h2 i {
        font-size: 20px;
        margin-right: 8px;
      }

      .table-box h2 small {
        font-size: 16px;
        font-weight: 400;
      }

      th {
        color: #a9b2ba !important;
        font-size: 14px;
      }

      td i {
        font-size: 24px;
      }

      .content-box {
        margin-bottom: 24px;
      }

      .content {
        background-color: white;
        padding: 20px 24px;
        border-radius: 16px 16px 0 16px;
      }

      .content-box small {
        color: #a9b2ba;
        font-size: 14px;
        padding: 8px;
      }

      h3 {
        font-size: 16px;
      }

      .top-section {
        flex-shrink: 0;
        margin-bottom: 24px;
      }

      .bottom-section {
        flex: 1;
        min-height: 0;
      }

      .top-left {
        flex: 1;
      }

      .top-right {
        width: 600px;
      }

      .bottom-left {
        width: 664px;
      }

      .bottom-right {
        flex: 1;
      }

      .left-panel {
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      .feedback-content {
        flex: 1;
        overflow-y: auto;
        padding-right: 8px;
        margin-bottom: 60px;
        min-height: 0;
      }

      .feedback-buttons {
        position: absolute;
        bottom: 12px;
        right: 20px;
        flex-shrink: 0;
      }

      .condition-group {
        padding-top: 8px;
      }

      .condition-item {
        margin-bottom: 0px;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: background-color 0.2s;
      }

      .condition-buttons {
        display: flex;
        gap: 8px;
        flex-shrink: 0;
      }

      .condition-btn {
        width: 32px;
        height: 32px;
        border: 1px solid #D0D7DE;
        border-radius: 4px;
        background: #FFFFFF;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
      }

      .condition-btn i {
        font-size: 20px;
      }

      .condition-btn.correct-btn i {
        color: #57AD57;
      }

      .condition-btn.correct-btn:hover {
        border-color: #BADEBA;
        background-color: #EEF7EE;
      }

      .condition-btn.correct-btn:hover i {
        color: #57AD57;
      }

      .condition-btn.correct-btn.active-correct {
        border-color: #BADEBA;
        background-color: #57AD57;
      }

      .condition-btn.correct-btn.active-correct i {
        color: #FFFFFF;
      }

      .condition-btn.incorrect-btn i {
        color: #DF6B42;
      }

      .condition-btn.incorrect-btn:hover {
        border-color: #F0BBA8;
        background-color: #FBEEE9;
      }

      .condition-btn.incorrect-btn:hover i {
        color: #DF6B42;
      }

      .condition-btn.incorrect-btn.active-incorrect {
        border-color: #F0BBA8;
        background-color: #DF6B42;
      }

      .condition-btn.incorrect-btn.active-incorrect i {
        color: #FFFFFF;
      }

      .condition-text {
        flex: 1;
        font-size: 16px;
        color: #374151;
        padding: 8px 0;
        line-height: 1.5;
        min-height: 24px;
        display: flex;
        align-items: center;
      }

      .category-row {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        font-size: 16px;
        color: #AFB8C1;
      }

      .info-button {
        width: 32px;
        height: 32px;
        border: none;
        background: none;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #AFB8C1;
        cursor: pointer;
        border-radius: 4px;
        position: relative;
      }

      .info-button:hover {
        background-color: transparent;
      }

      .info-button i {
        font-size: 20px;
        transition: all 0.2s;
      }

      .info-button::before {
        content: attr(title);
        position: absolute;
        bottom: 100%;
        right: 0;
        background: #2A2A3A;
        color: white;
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 14px;
        white-space: nowrap;
        opacity: 0;
        visibility: hidden;
        transform: translateY(10px);
        transition: all 0.3s ease;
        z-index: 1000;
        max-width: 300px;
        white-space: normal;
        line-height: 1.4;
      }

      .info-button::after {
        content: '';
        position: absolute;
        bottom: 100%;
        right: 8px;
        border: 6px solid transparent;
        border-top-color: #2A2A3A;
        opacity: 0;
        visibility: hidden;
        transform: translateY(16px);
        transition: all 0.3s ease;
        z-index: 1001;
      }

      .info-button:hover::before,
      .info-button:hover::after {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .category-items .condition-item {
        display: flex;
        align-items: center;
        padding: 4px;
        margin-bottom: 4px;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      .category-items .condition-item:hover {
        background-color: #F7F6F5;
      }

      .category-items .condition-item i {
        color: #6E7781;
        font-size: 24px;
        margin-right: 8px;
      }

      #previewArea h3 {
        font-size: 20px;
      }

      .copy-toast {
        position: absolute;
        top: -50px;
        right: 0;
        background: #2A2A3A;
        color: white;
        padding: 12px 16px;
        border-radius: 4px;
        font-size: 16px;
        opacity: 0;
        transform: translateY(10px);
        transition: all 0.3s ease;
        pointer-events: none;
        white-space: nowrap;
        z-index: 1000;
      }

      .copy-toast.show {
        opacity: 1;
        transform: translateY(0);
      }

      .btn-copy {
        position: relative;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="top-section">
        <div class="d-flex gap-3">
          <div class="top-left">
            <div class="p-3">
              <h1 class="section-title">
                助教 <span id="ta_text">Demo助教</span> 的
                <span id="work_text">Week1</span> 作業批改區
              </h1>
              <ol class="section-text mt-3">
                <li>記得檢查是否有更新作業小卡上「繳交狀態」、「批改狀態」、「批改班長」的欄位</li>
                <li>批改完成後，記得將右側的「作業表現」結果更新至「<a href="https://www.notion.so/simonlin7972/UIBC-3-1f895b29efc980bc9a2ef5a24eba8e60?source=copy_link#1f895b29efc980b684f8f67bc8b00721" target="_blank">班長作業＆專案批改區</a>」</li>
              </ol>
            </div>
          </div>
          <div class="top-right">
            <div class="d-flex gap-3 h-100 align-items-end">
              <div class="content-box w-100">
                <div class="content">
                  這份作業在「基礎錯誤」項目有被扣分，因此作業評級為「有待加強」
                </div>
                <small>批改結果僅作為參考，助教仍可斟酌調整評級</small>
              </div>
              <div class="d-flex align-items-end">
                <img
                  src="https://i.ibb.co/qFYQP9Wg/Student-Avatar.png"
                  style="width: 60px; height: 60px;"
                />
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="bottom-section">
        <div class="d-flex gap-2 h-100">
          <div class="bottom-left">
            <div class="text-box">
              <div class="d-flex gap-2 h-100" style="align-items: flex-start;">
                <div class="edit-icon" style="flex-shrink: 0;">
                  <img
                    src="https://www.notion.so/icons/drafts_gray.svg?mode=light"
                    style="width: 24px"
                  />
                </div>
                <div class="feedback-content">
                  <div id="previewArea">
                    <p>哈囉 @OOO，我是班長大雄！準時繳交第一週作業辛苦了！💗</p>
                    <p>以下將根據作業標準進行回饋：</p>
                    <h3>基礎條件</h3>
                    <p>- </p>
                    <p>期待再收到你講讀的作業 💗</p>
                  </div>
                </div>
              </div>

              <div class="feedback-buttons d-flex justify-content-end">
                <button class="btn btn-copy" onclick="copyFeedback()">
                  <i class="ph ph-copy me-1"></i>複製
                </button>
                <button class="btn btn-clear" onclick="clearFeedback()">
                  <i class="ph ph-broom me-1"></i>清除
                </button>
              </div>
            </div>
          </div>

          <div class="bottom-right">
            <div class="table-box">
              <div>
                <h2
                  class="d-flex justify-content-between align-items-end title title-success"
                >
                  <span><i class="ph-fill ph-triangle"></i>基礎條件</span>
                </h2>

                <div class="condition-group" id="condition-group-1">
                  <div class="condition-item" data-title="畫面設計完成">
                    <div class="condition-buttons">
                      <button class="condition-btn correct-btn" data-type="O">
                        <i class="ph ph-circle"></i>
                      </button>
                      <button class="condition-btn incorrect-btn" data-type="X">
                        <i class="ph ph-x"></i>
                      </button>
                    </div>
                    <div class="condition-text">畫面設計完成</div>
                    <button class="info-button" title="Desktop 和 Mobile 各完成一頁頁面，畫面中所有內容皆為完整實際內容，實際完善作品" onmouseenter="this.querySelector('i').className='ph-fill ph-info'" onmouseleave="this.querySelector('i').className='ph ph-info'">
                      <i class="ph ph-info"></i>
                    </button>
                  </div>

                  <div class="condition-item" data-title="品牌設計初步應用">
                    <div class="condition-buttons">
                      <button class="condition-btn correct-btn" data-type="O">
                        <i class="ph ph-circle"></i>
                      </button>
                      <button class="condition-btn incorrect-btn" data-type="X">
                        <i class="ph ph-x"></i>
                      </button>
                    </div>
                    <div class="condition-text">品牌設計初步應用</div>
                    <button class="info-button" title="使用繪製設計好的品牌色與 Logo，並套用於主要元件中">
                      <i class="ph ph-info"></i>
                    </button>
                  </div>

                  <div class="condition-item" data-title="Auto Layout 基礎使用">
                    <div class="condition-buttons">
                      <button class="condition-btn correct-btn" data-type="O">
                        <i class="ph ph-circle"></i>
                      </button>
                      <button class="condition-btn incorrect-btn" data-type="X">
                        <i class="ph ph-x"></i>
                      </button>
                    </div>
                    <div class="condition-text">Auto Layout 基礎使用</div>
                    <button class="info-button" title="至少於畫面中 1 個區域使用 Auto Layout，讓畫面可簡易容器">
                      <i class="ph ph-info"></i>
                    </button>
                  </div>
                </div>
              </div>
              <div class="pt-4">
                <h2
                  class="d-flex justify-content-between align-items-end title title-warning"
                >
                  <span><i class="ph-fill ph-shapes"></i>進階條件</span>
                </h2>

                <div id="advanced-conditions">
                  <div class="category-section">
                    <div class="category-row" style="margin-top: 12px;">
                      <span>自訂品牌精神</span>
                      <button class="info-button" title="自行定義品牌色與 Logo，並說明設計">
                        <i class="ph ph-info"></i>
                      </button>
                    </div>
                    <div class="category-items">
                      <div class="condition-item" data-category="自訂品牌精神" data-item="自行建立品牌色彩 Logo">
                        <i class="ph ph-circle" style="font-size: 24px; color: #6E7781; margin-right: 8px;"></i>
                        <span style="margin-right: 8px;">+1</span>
                        <span style="flex: 1;">自行建立品牌色彩 Logo</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="pt-4">
                <h2
                  class="d-flex justify-content-between align-items-end title title-danger"
                >
                  <span><i class="ph ph-shapes"></i>挑戰條件</span>
                </h2>

                <div id="challenge-conditions">
                  <div class="category-section">
                    <div class="category-row" style="margin-top: 12px;">
                      <span>設計樣式一致性</span>
                      <button class="info-button" title="在所有元件中使用單一元素的一致性設計">
                        <i class="ph ph-info"></i>
                      </button>
                    </div>
                    <div class="category-items">
                      <div class="condition-item" data-category="設計樣式一致性" data-item="設計到產品本身一致">
                        <i class="ph ph-circle" style="font-size: 24px; color: #6E7781; margin-right: 8px;"></i>
                        <span style="margin-right: 8px;">+1</span>
                        <span style="flex: 1;">設計到產品本身一致</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      let totalScore = 0;
      let openingText = "哈囉 @OOO，我是班長大雄！準時繳交第一週作業辛苦了！💗\n\n以下將根據作業標準進行回饋：";
      let closingText = "期待再收到你講讀的作業 💗";
      let md = "";
      let feedbackList = [];

      function handleConditionClick(title, result, content, activeBtn, otherBtn, type) {
        otherBtn.classList.remove('active-correct', 'active-incorrect');
        
        const isCurrentlyActive = activeBtn.classList.contains('active-correct') || 
                                 activeBtn.classList.contains('active-incorrect');
        
        if (isCurrentlyActive) {
          activeBtn.classList.remove('active-correct', 'active-incorrect');
          deleteItem(title, content, 0, type);
        } else {
          if (result === 'O') {
            activeBtn.classList.add('active-correct');
            addItem(title, "畫面設計完成很棒", 0, type);
          } else {
            activeBtn.classList.add('active-incorrect');
            addItem(title, "畫面設計沒有設計完成理由？？", 0, type);
          }
        }
      }

      function handleCategoryItemClick(category, item, content, score, type, clickedDiv) {
        const icon = clickedDiv.querySelector("i");
        const isSelected = icon.classList.contains("ph-check-circle");
        
        if (isSelected) {
          icon.classList.remove("ph-fill", "ph-check-circle");
          icon.classList.add("ph", "ph-circle");
          deleteItem(item, content, score, type);
        } else {
          const categoryItems = document.querySelectorAll(`[data-category="${category}"]`);
          categoryItems.forEach(div => {
            const otherIcon = div.querySelector("i");
            if (otherIcon.classList.contains("ph-check-circle")) {
              otherIcon.classList.remove("ph-fill", "ph-check-circle");
              otherIcon.classList.add("ph", "ph-circle");
              const otherItem = div.dataset.item;
              feedbackList = feedbackList.filter(f => !(f.type === type && f.title === otherItem));
            }
          });
          
          icon.classList.remove("ph", "ph-circle");
          icon.classList.add("ph-fill", "ph-check-circle");
          addItem(item, "(回饋內容) 自行建立品牌色彩 Logo", score, type);
        }
        
        updateFeedbackArea();
      }

      // 為按鈕添加事件監聽器
      document.addEventListener('DOMContentLoaded', function() {
        // 基礎條件按鈕
        const basicConditions = document.querySelectorAll('#condition-group-1 .condition-item');
        basicConditions.forEach(item => {
          const title = item.dataset.title;
          const correctBtn = item.querySelector('.correct-btn');
          const incorrectBtn = item.querySelector('.incorrect-btn');
          
          correctBtn.onclick = (e) => {
            e.stopPropagation();
            handleConditionClick(title, 'O', '', correctBtn, incorrectBtn, 'praise');
          };
          
          incorrectBtn.onclick = (e) => {
            e.stopPropagation();
            handleConditionClick(title, 'X', '', incorrectBtn, correctBtn, 'praise');
          };
        });

        // 進階和挑戰條件按鈕
        const advancedItems = document.querySelectorAll('#advanced-conditions .condition-item');
        advancedItems.forEach(item => {
          const category = item.dataset.category;
          const itemName = item.dataset.item;
          item.onclick = () => {
            handleCategoryItemClick(category, itemName, '', 1, 'base', item);
          };
        });

        const challengeItems = document.querySelectorAll('#challenge-conditions .condition-item');
        challengeItems.forEach(item => {
          const category = item.dataset.category;
          const itemName = item.dataset.item;
          item.onclick = () => {
            handleCategoryItemClick(category, itemName, '', 1, 'adv', item);
          };
        });

        updateFeedbackArea();
      });

      function addItem(title, content, score, type) {
        const item = {
          content: `- ${content}`,
          title,
          score: parseInt(score),
          type,
        };
        feedbackList.push(item);
        updateFeedbackArea();
      }

      function deleteItem(title, content, score, type) {
        feedbackList = feedbackList.filter(
          (i) => !(i.title === title && i.type === type)
        );
        updateFeedbackArea();
      }

      function updateFeedbackArea() {
        const basicConditions = feedbackList.filter(f => f.type === "praise").map(f => f.content);
        const advancedConditions = feedbackList.filter(f => f.type === "base").map(f => f.content);
        const challengeConditions = feedbackList.filter(f => f.type === "adv").map(f => f.content);
        
        const basic = basicConditions.length > 0 ? basicConditions.join("\n\n") : "- ";
        const advanced = advancedConditions.length > 0 ? advancedConditions.join("\n\n") : "";
        const challenge = challengeConditions.length > 0 ? challengeConditions.join("\n\n") : "";
        
        let feedbackContent = `${openingText}\n\n### 基礎條件\n${basic}`;
        
        if (advanced) {
          feedbackContent += `\n\n### 進階條件\n${advanced}`;
        }
        
        if (challenge) {
          feedbackContent += `\n\n### 挑戰條件\n${challenge}`;
        }
        
        feedbackContent += `\n\n${closingText}`;
        
        md = feedbackContent;
        document.getElementById("previewArea").innerHTML = marked.parse(md);
      }

      function copyFeedback() {
        navigator.clipboard
          .writeText(md)
          .then(() => {
            showCopyToast();
          })
          .catch((err) => {
            alert("複製失敗");
          });
      }

      function showCopyToast() {
        const copyBtn = document.querySelector('.btn-copy');
        
        // 移除已存在的 toast
        const existingToast = copyBtn.querySelector('.copy-toast');
        if (existingToast) {
          existingToast.remove();
        }
        
        // 創建新的 toast
        const toast = document.createElement('div');
        toast.className = 'copy-toast';
        toast.textContent = '已複製';
        copyBtn.appendChild(toast);
        
        // 顯示動畫
        setTimeout(() => {
          toast.classList.add('show');
        }, 10);
        
        // 1秒後隱藏並移除
        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => {
            toast.remove();
          }, 300);
        }, 1000);
      }

      function clearFeedback() {
        feedbackList = [];
        
        // 清除所有按鈕狀態
        document.querySelectorAll('.condition-btn').forEach(btn => {
          btn.classList.remove('active-correct', 'active-incorrect');
        });
        
        document.querySelectorAll('.category-items .condition-item i').forEach(icon => {
          icon.classList.remove("ph-fill", "ph-check-circle");
          icon.classList.add("ph", "ph-circle");
        });
        
        updateFeedbackArea();
      }
    </script>
  </body>
</html>
